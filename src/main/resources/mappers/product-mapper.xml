<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace= "ProductMapper" >
	<resultMap type="Product" id="productResultMap">
		<id property="productNo"			column="PRODUCT_NO"/>
		<result property="productName"		column="PRODUCT_NAME"/>
		<result property="category"			column="CATEGORY"/>
		<result property="productPrice"		column="PRODUCT_PRICE"/>
		<result property="productColor"		column="PRODUCT_COLOR"/>
		<result property="productStock"		column="PRODUCT_STOCK"/>
		<result property="mainFileName"		column="MAIN_FILE_NAME"/>
		<result property="mainFilePath"		column="MAIN_FILE_PATH"/>
		<result property="mainFileRename"	column="MAIN_FILE_RENAME"/>
		<result property="updateDate"		column="UPDATE_DATE"/>
		<result property="brandName"		column="BRAND_NAME"/>
		<result property="productMaterial"	column="PRODUCT_MATERIAL"/>
		<result property="saleCount"		column="SALE_COUNT"/> 	
	</resultMap>
	<resultMap type="Product" id="productNameResultMap">
		<result property="productName"		column="PRODUCT_NAME"/>
	</resultMap>
	<resultMap type="Detail" id="detailResultMap">
		<id property="productNo"		column="PRODUCT_NO"/>
		<result property="detailFileName" column="DETAIL_FILE_NAME"/>
		<result property="detailFilePath" column="DETAIL_FILE_PATH"/>
		<result property="detailFileRename" column="DETAIL_FILE_RENAME"/>
		<result property="detailContents" column="DETAIL_CONTENTS"/>
	</resultMap>
  	<insert id="insertProduct" parameterType="Product">
  		<selectKey resultType="int" keyProperty="productNo" order="BEFORE">
			SELECT PRODUCT_SEQNO.NEXTVAL FROM DUAL
		</selectKey>
  	 	INSERT INTO PRODUCT_TBL
  	 	VALUES(#{productNo}, #{productName},#{category},#{productPrice},#{productColor},#{productStock},#{mainFileName},#{mainFilePath},#{mainFileRename},DEFAULT,#{brandName},#{productMaterial},DEFAULT)
  	</insert>
  	<select id="selectAllProduct" resultMap="productResultMap">
  		SELECT * FROM PRODUCT_TBL
  	</select>
  	<insert id="insertProductDetail" parameterType="Detail">
  		INSERT INTO DETAIL_TBL
  		VALUES(#{productNo},#{detailFileName},#{detailFilePath},#{detailFileRename},#{detailContents})
  	</insert>
  	<select id="selectAllProductByArrayDf" parameterType="String" resultMap="productResultMap">
		<choose >
			<when test="arrayCd.toString() =='newArrival'">
				SELECT*FROM(SELECT*FROM PRODUCT_TBL ORDER BY UPDATE_DATE DESC) WHERE  <![CDATA[ROWNUM<=20 ]]>
			</when>
			<when test="arrayCd.toString() =='topSale'">
				SELECT*FROM(SELECT*FROM PRODUCT_TBL ORDER BY SALE_COUNT DESC) WHERE  <![CDATA[ROWNUM<=20 ]]>
			</when>
			<otherwise>
				SELECT * FROM PRODUCT_TBL
			</otherwise>
		</choose>
		
  	</select>
  	<select id="selectProductByNo" resultMap="productResultMap">
  		SELECT*FROM PRODUCT_TBL WHERE PRODUCT_NO=#{productNo}
  	</select>
  	<select id="selectAllDetailInfo" resultMap="detailResultMap">
  		SELECT*FROM DETAIL_TBL WHERE PRODUCT_NO=#{productNo}
  	</select>
  	<select id="selectProductName" resultType="String">
  		SELECT PRODUCT_NAME FROM PRODUCT_TBL WHERE PRODUCT_NO=#{productNo}
  	</select>
  	<select id="selectProductByKeyword" resultMap="productResultMap">
  		SELECT * FROM PRODUCT_TBL 
  		<where>
  			PRODUCT_NAME LIKE '%'||#{keyword}||'%' 
  			OR CATEGORY LIKE '%'||#{keyword}||'%' 
  			OR PRODUCT_COLOR LIKE '%'||#{keyword}||'%' 
  			OR BRAND_NAME LIKE '%'||#{keyword}||'%'
  		</where>
  	</select>
  	<select id="selectProductByBrand" resultMap="productResultMap">
  		SELECT PRODUCT_NO, MAIN_FILE_RENAME, PRODUCT_NAME, PRODUCT_COLOR, PRODUCT_PRICE FROM PRODUCT_TBL WHERE BRAND_NAME=#{brandName}OR BRAND_NAME LIKE '%'||#{brandName}||'%'
  			<if test="sortCd.toString()=='new'">
  			ORDER BY UPDATE_DATE DESC
  			</if>		
  			<if test="sortCd.toString()=='highPrice'">
  			ORDER BY PRODUCT_PRICE DESC
  			</if>		
  			<if test="sortCd.toString()=='rowPrice'">
  			ORDER BY PRODUCT_PRICE
  			</if>		
  			<if test="sortCd.toString()=='sale'">
  			ORDER BY SALE_COUNT DESC
  			</if>		
  	</select>
  
</mapper>